<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>添加新权限|<{$configcache['Title']}></title>
<link rel="stylesheet" type="text/css" href="__CSS__/content.css"  />
<link rel="stylesheet" type="text/css" href="__CSS__/public.css"  />
<script type="text/javascript" src="__JS__/jquery.js"></script>
<script type="text/javascript" src="__JS__/Public.js"></script>
<script type="text/javascript" src="__JS__/winpop.js"></script>
<script type="text/javascript" src="__JS__/jquery.validate.js"></script>
<!-- <script type="text/javascript" src="__JS__/check.js"></script> -->
<style>
	body{background: #fff;}	
	.error{float: left;color:red;line-height: 40px;}
</style>
<script>
$(document).ready(function() {
	jQuery.validator.addMethod("english", function(value, element) {
	    var chrnum = /^([a-zA-Z]+)$/;
	    return this.optional(element) || (chrnum.test(value));
	}, "只能输入字母");
	$("#add").validate({
            rules : {
                sid : {
                    required:true
                },
                cname : {
                    required : true
                },
                controller : {
                    required : true,
                    english:["a","f"]
                },
                action : {
                    required : true,
                    english:["a","f"]
                },
                grade : {
                	required : true,
                	number:true
                }
            },
            messages : {
                sid : {
                    required:'请选择权限分类'
                },
                cname : {
                    required : '权限名称不得为空！'  
                },
                controller : {
                    required : '控制器不得为空！',
                },
                action : {
                    required : '方法不得为空！'
                },
                grade : {
                	required : '不能为空',
                	number:'请输入合法的数字'
                }  
            }
        });

	$('.button').click(function() {
		$("#add").submit(); 
		$(":input").blur();
		var sid=$('#dl dd .select').val();
		var cname=$('#cname').val();
		var controller=$('#controller').val();
		var action=$('#action').val();
		var grade=$('#grade').val();
		var description=$('#dl dd .textarea').val();
		
		
		// if (!tcheck(sid,'','权限获取失败')) { return false; }
		// if (!tcheck(sid,'number','目录ID获取失败')) { return false; }
		// if (!tcheck(cname,'','请填写权限名称')) { return false; }
		// if (!tcheck(grade,'','请填写排序')) { return false; }

		// if (!tcheck(cname,'2,20','权限名称请在20个字符以内','length')) { return false; }
		// if (!tcheck(grade,'number','1,5','排序优先级请在1-5个字符','length')) { return false; }
		// if (!tcheck(description,'0,30','描述请在30个字符以内','length')) { return false; }
		// if(sid>0){
		// 	if (!tcheck(controller,'','请填写控制器')) { return false; }
		// 	if (!tcheck(action,'','请填方法')) { return false; }
		// 	if (!tcheck(controller,'2,20','控制器请在20个字符以内','length')) { return false; }
		// 	if (!tcheck(action,'2,20','方法请在20个字符以内','length')) { return false; }
		// }
		
		wintq('正在添加，请稍后...',4,20000,0,'');
		$.ajax({
			url:'__APP__/Diction/cadd_do/',
			dataType:'json',
			type:'POST',
			data:'sid='+sid+'&cname='+cname+'&description='+description+'&controller='+controller+'&action='+action+'&grade='+grade,
			success: function(data) {
				if (data.s=='ok') {
					wintq('添加成功',1,1500,0,'__APP__/Diction/add/');
				}else {
					wintq(data.s,3,1500,1,'');
				}
			}
		});
	});
});
</script>
</head>
<body>
<div id="content"  class="content_box">
	<form id="add">
		<dl id="dl">   	
	        <dd>
	        	<span class="dd_left">权限分类：</span>
	            <span class="dd_right">
	            	<select name="p_id" class="select qtext" style="height: 40px; width: 605px;" name="sid">
	                	<option value="0">顶级目录</option>
	                    <foreach name='volist' item='vo'>
	                    <option value="<{$vo.id}>"><{$vo.opera_name}></option>
	                    </foreach>
	                </select>
	            </span>
	        </dd>
	        <dd>
	        	<span class="dd_left">权限名称：</span>
	        	<span class="dd_right">
	        		<input type="text" id="cname" class="qtext" placeholder="* 输入如：用户管理" style="height: 40px; width: 595px;" name="cname"/>
	        	</span>
	        </dd>
	        
	        <dd>
	        	<span class="dd_left">控制器：</span>
	            <span class="dd_right"><input type="text"  placeholder="* 输入如：role" id="controller"  style="height: 40px; width: 595px;" class="qtext" name="controller"/></span>
	        </dd>
	        <dd>
	        	<span class="dd_left">方法：</span>
	            <span class="dd_right"><input type="text" style="height: 40px; width: 595px;"   placeholder="* 输入如：roleadd" id="action" class="qtext" name="action"/></span>
	        </dd>
	        <dd>
	        	<span class="dd_left">权限优先级：</span>
	            <span class="dd_right">
	            	<input type="text" style="height: 40px; width: 595px;"   placeholder="*输入数字" id="grade" class="qtext" name="grade"/>
				</span>
	        </dd>       
	        <dd>
	        	<span class="dd_left">权限说明：</span>
	            <span class="dd_right">
	            	<textarea name="description" class="textarea" style="width: 606px;"></textarea>
	            </span>
	        </dd>
	        <dd><input type="button" class="button" value="提 交" /></dd>
	    </dl>
    </form>
</div>
</body>
</html>
